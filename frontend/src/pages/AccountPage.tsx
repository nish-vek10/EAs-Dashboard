import { Link, useParams } from "react-router-dom";import { fetchAccountPositions, type Position } from "../api";import { subscribe, type LiveEvent } from "../live";import AccountPositions from "../components/AccountPositions";import { getGroup, setGroup, type Group } from "../groups";export default function AccountPage() {  const { loginHint = "" } = useParams();  const [snapshot, setSnapshot] = useState<any>(null);  const [positions, setPositions] = useState<Position[]>([]);  const [updatedAt, setUpdatedAt] = useState<string | undefined>(undefined);  const [error, setError] = useState<string | null>(null);  const [group, setGroupState] = useState<Group>(getGroup(loginHint));  useEffect(() => {    setError(null);    fetchAccountPositions(loginHint)      .then(({ snapshot, positions, updated_at }) => {        setSnapshot(snapshot);        setPositions(positions || []);        setUpdatedAt(updated_at);      })      .catch(err => setError(err.message));    const unsub = subscribe((evt: LiveEvent) => {      if (evt.type !== "positions_snapshot") return;      if (evt.account !== loginHint) return;      setSnapshot(evt.snapshot);      setPositions(Array.isArray(evt.positions) ? evt.positions : []);      setUpdatedAt(evt.ts);    });    setGroupState(getGroup(loginHint));    return () => unsub();  }, [loginHint]);  const handleGroup = (g: Group) => {    setGroup(loginHint, g);    setGroupState(g);  };  return (    <div style={{ display: "grid", gap: 16 }}>      <div style={{ display: "flex", alignItems: "center", gap: 12 }}>        <Link to="/" className="muted">← Back</Link>        <h2 style={{ fontSize: 20, fontWeight: 800, letterSpacing: ".02em", margin:0 }}>Account: {loginHint}</h2>        <div style={{ marginLeft: "auto", display:"flex", alignItems:"center", gap:8 }}>          <span className="muted" style={{ fontSize:12 }}>Group:</span>          <select            value={group}            onChange={(e) => handleGroup(e.target.value as Group)}            style={{ background:"#0e1422", color:"var(--text)", border:"1px solid var(--border)", borderRadius:8, padding:"6px 8px" }}          >            <option value="All">All</option>            <option value="E2T">E2T</option>            <option value="Nish">Nish Algos</option>          </select>        </div>      </div>      {error ? (        <div className="rowcard" style={{ borderColor: "rgba(239,68,68,.35)" }}>{error}</div>      ) : (        <>          <div style={{ display:"flex", gap:12, flexWrap:"wrap" }}>            <KPI label="Balance" value={fmt(snapshot?.balance)} />            <KPI label="Equity" value={fmt(snapshot?.equity)} />            <KPI label="Margin" value={fmt(snapshot?.margin)} />            <KPI label="Free" value={fmt(snapshot?.margin_free)} />          </div>          <div className="muted" style={{ fontSize: 12 }}>            Updated: {updatedAt ? new Date(updatedAt).toLocaleTimeString() : "—"}          </div>          <AccountPositions positions={positions} />        </>      )}    </div>  );}function KPI({ label, value }: { label: string; value: string }) {  return (    <div className="kpi">      <div className="label">{label}</div>      <div className="value">{value}</div>    </div>  );}function fmt(n?: number) {  if (typeof n !== "number") return "—";  return n.toLocaleString(undefined, { maximumFractionDigits: 2 });}

